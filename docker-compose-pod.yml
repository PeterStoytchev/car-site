version: '2'

networks:
  be:
    external:
      name: car-net

services:
  carapi:
    build: car-api/.
    environment:
      - dbHost=db
      - dbUser=api
      - dbPasswd=ApiPass123.
      - dbName=car-db
    networks:
      be:
        aliases:
          - car-api

  frontend:
    build: frontend/.
    environment:
      - ENDPOINT=car-api:5001
    networks:
      be:
        aliases:
          - frend
          
  mysql_slave:
    image: mysql:5.7
    env_file:
      - ./mysql_pod/mysql_pod.env
    container_name: "mysql_pod"
    restart: "no"
    ports:
      - "3306:3306"
    volumes:
      - ./mysql_pod/conf/mysql.conf.cnf:/etc/mysql/conf.d/mysql.conf.cnf
    networks:
      be:

  reverse_proxy:
    build: car-x/.
    ports:
      - "80:80"
    depends_on:
      - carapi
      - frontend
    networks:
      be:
        aliases:
          - revprox