version: '2'

networks:
  carnet:
    driver: bridge

services:
  carapi:
    build: car-api/.
    environment:
      - dbHost=db
      - dbUser=root
      - dbPasswd=111
      - dbName=car-db
    networks:
      carnet:
        aliases:
          - car-api

  frontend:
    build: frontend/.
    environment:
      - ENDPOINT=car-api:5001
    networks:
      carnet:
        aliases:
          - frend
          
  mysql_slave:
    image: mysql:5.7
    env_file:
      - ./mysql_pod/mysql_pod.env
    container_name: "mysql_pod"
    restart: "no"
    volumes:
      - ./mysql_pod/conf/mysql.conf.cnf:/etc/mysql/conf.d/mysql.conf.cnf
    networks:
      carnet:
        aliases:
          - db

  reverse_proxy:
    build: car-x/.
    ports:
      - "80:80"
    depends_on:
      - carapi
      - frontend
    networks:
      carnet:
        aliases:
          - revprox